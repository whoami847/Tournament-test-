
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper functions to make rules easier to read
    function isSignedIn() {
      return request.auth != null;
    }

    function isOwner(userId) {
      return isSignedIn() && request.auth.uid == userId;
    }
    
    // --- PUBLIC-FACING DATA ---
    // Anyone can read this data, but only signed-in users (admins) can write.
    match /games/{gameId} {
      allow read: if true;
      allow write: if isSignedIn();
    }

    match /tournaments/{tournamentId} {
      allow read: if true;
      allow write: if isSignedIn(); // Allows joining and admin updates
    }

    match /featured_banners/{bannerId} {
      allow read: if true;
      allow write: if isSignedIn();
    }
    
    match /withdrawMethods/{methodId} {
       allow read: if true;
       allow write: if isSignedIn();
    }

    // --- USER-SPECIFIC DATA ---
    // Users can only access their own documents.
    match /users/{userId} {
      allow read: if isSignedIn();
      allow create: if isOwner(userId); // A user can create their own profile
      allow update: if isOwner(userId) || isSignedIn(); // User can update their own, admin can update any
    }

    match /notifications/{notificationId} {
      allow read, write: if isSignedIn() && resource.data.userId == request.auth.uid;
    }
    
    match /transactions/{transactionId} {
       allow read, create: if isSignedIn() && resource.data.userId == request.auth.uid;
       // Transactions should not be changed or deleted by users
       allow update, delete: if false; 
    }

    // --- LOGIC-HEAVY COLLECTIONS ---
    // These require more complex logic, but for now, we allow any signed-in user
    // to perform actions. In production, you would add more specific rules.
    match /teams/{teamId} {
      allow read, write: if isSignedIn();
    }
    
    match /registrations/{regId} {
      allow read, write: if isSignedIn();
    }
    
    match /matchResults/{resultId} {
      allow read, write: if isSignedIn();
    }
    
    match /pendingPrizes/{prizeId} {
       allow read, write: if isSignedIn();
    }
    
    match /withdrawRequests/{reqId} {
      allow read, write: if isSignedIn();
    }
    
     // Default catch-all for any other collections.
     // In a real app, this should be more restrictive.
    match /{document=**} {
      allow read, write: if isSignedIn();
    }
  }
}
